<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pembayaran â€” Juragan Buah</title>

<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/utilities.css">

<style>
body { background: #f6f6f6; }

.pay-container {
  max-width: 850px;
  margin: 110px auto;
}

.box {
  background: #fff;
  padding: 20px;
  border-radius: 14px;
  margin-bottom: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.06);
}

.qris {
  width: 230px;
  border-radius: 12px;
  margin: 20px 0;
}

.bank-box {
  background: #f4fff4;
  padding: 15px;
  border: 1px solid #8adf8a;
  border-radius: 12px;
}

.upload-btn {
  background: #00a13c;
  padding: 12px;
  width: 100%;
  border-radius: 12px;
  color: #fff;
  cursor: pointer;
  font-weight: bold;
  text-align: center;
}
</style>
</head>

<body>

<header class="navbar-green">
  <div class="nav-inner">
    <a class="brand" href="index.html">Juragan Buah</a>
    <nav>
      <a href="index.html">Home</a>
      <a href="projects.html">Produk</a>
      <a href="checkout.html">Checkout</a>
      <a class="active" href="payment.html">Payment</a>
      <a href="tracking.html">Tracking</a>
    </nav>
  </div>
</header>

<div class="pay-container">

  <div class="box">
    <h2>ðŸ’¸ Metode Pembayaran</h2>

    <div id="payInfo"></div>
  </div>

  <div class="box">
    <h3>Upload Bukti Pembayaran</h3>
    <input type="file" accept="image/*" onchange="saveProof(this.files[0])">
  </div>

  <button class="upload-btn" onclick="finishOrder()">Kirim Konfirmasi Pembayaran</button>

</div>

<script src="assets/js/app.js"></script>

<script>
const order = JSON.parse(localStorage.getItem("LAST_ORDER"));
if(!order){
  document.body.innerHTML = "<p>Order tidak ditemukan.</p>";
}

document.getElementById("payInfo").innerHTML = `
  <p><strong>ID Pesanan:</strong> ${order.id}</p>
  <p><strong>Total:</strong> ${currency(order.total)}</p>
  <hr>
  ${order.payMethod === 'transfer' ? `
    <div class="bank-box">
      <b>Transfer Bank</b><br>
      BRI â€” 123 456 789 a.n Juragan Buah
    </div>
  `: ""}

  ${order.payMethod === 'qris' ? `
    <div>
      <b>Scan QRIS:</b><br>
      <img src="assets/img/qris.jpg" class="qris">
    </div>
  `: ""}

  ${order.payMethod === 'cod' ? `
    <div class="bank-box">
      <b>COD</b><br>
      Bayar saat barang diterima.
    </div>
  `: ""}
`;

function saveProof(file){
  let reader = new FileReader();
  reader.onload = () => {
    order.paymentProof = reader.result;
    localStorage.setItem("LAST_ORDER", JSON.stringify(order));
    alert("Bukti pembayaran tersimpan!");
  };
  reader.readAsDataURL(file);
}

function finishOrder(){
  localStorage.setItem("TRACKING_ORDER", JSON.stringify(order));

  // kirim ke WA
  window.open(
    `https://wa.me/${order.phone}?text=Halo%20Admin,%20saya%20sudah%20upload%20bukti%20pembayaran.%0AID:%20${order.id}`
  );

  window.location.href = "tracking.html";
}
</script>
</body>
</html>
